<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Budget Tracker</title>
  <style>
    /* General page styles */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f4f4f9;
      color: #333;
    }

    h1 {
      margin: 0;
      padding: 20px;
      text-align: center;
      background: #2c3e50;
      color: white;
      font-size: 1.8rem;
    }

    .container {
      display: flex;
      flex-wrap: nowrap;
      height: calc(100vh - 80px);
    }

    /* Sidebar */
    .left-panel {
      width: 30%;
      background: #ffffff;
      border-right: 1px solid #ccc;
      padding: 20px;
      overflow-y: auto;
    }

    /* Main content area */
    .right-panel {
      flex-grow: 1;
      padding: 20px;
      overflow-y: auto;
      background: #f9f9f9;
    }

    /* Form section */
    .transaction-form {
      margin-bottom: 30px;
      padding: 15px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .transaction-form h3 {
      margin-bottom: 10px;
      color: #34495e;
      font-size: 1.2rem;
    }

    label {
      font-weight: bold;
      display: block;
      margin-top: 10px;
      margin-bottom: 5px;
    }

    input, select, button {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    button {
      background: #2ecc71;
      color: white;
      font-size: 1rem;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    button:hover {
      background: #27ae60;
    }

    /* Transaction list */
    .transaction-list {
      margin-bottom: 30px;
      padding: 15px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .transaction-list h3 {
      margin-bottom: 10px;
      font-size: 1.2rem;
      color: #34495e;
    }

    /* Transaction item container */
    .transaction-item {
        display: flex;
        align-items: center;
        justify-content: space-between; /* Space between text and button */
        padding: 10px 0;
        border-bottom: 1px solid #ddd;
    }

    .transaction-item div {
      flex-grow: 1;
      text-align: left;
      word-wrap: break-word; /* Prevent text overflow */
    }

    .transaction-item button {
        background: #e74c3c;       /* Button background color */
        color: white;              /* Button text color */
        border: none;              /* No border */
        width: 1in;                /* Set width to 1 inch */
        padding: 10px 0;            /* Adjust padding for compact height */
        font-size: 1rem;         /* Small text size */
        border-radius: 6px;        /* Rounded corners */
        cursor: pointer;           /* Pointer cursor on hover */
        transition: background 0.3s ease; /* Smooth hover effect */
        text-align: center;        /* Center the text within the button */
    }

    .transaction-item button:hover {
      background: #c0392b;
    }

    .transaction-item:last-child {
      border-bottom: none;
    }

    /* Pie chart */
    .chart-container {
      margin: 20px 0;
      padding: 15px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .chart-container h3 {
      text-align: center;
      margin-bottom: 20px;
      color: #34495e;
      font-size: 1.2rem;
    }

    /* Footer */
    footer {
      padding: 10px;
      text-align: center;
      background: #2c3e50;
      color: white;
      font-size: 0.8rem;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>

<h1>Budget Tracker</h1>

<div class="container">
  <!-- Left Panel -->
  <div class="left-panel">
    <div class="transaction-form">
      <h3>Add Transaction</h3>
      <label for="description">Description</label>
      <input type="text" id="description" placeholder="e.g., Salary, Groceries">
      <label for="amount">Amount</label>
      <input type="number" id="amount" placeholder="e.g., 100">
      <label for="category">Category</label>
      <select id="category">
        <option value="income">Income</option>
        <option value="groceries">Groceries</option>
        <option value="rent">Rent</option>
        <option value="entertainment">Entertainment</option>
        <option value="others">Others</option>
      </select>
      <label for="date">Date</label>
      <input type="date" id="date">
      <button onclick="addTransaction()">Add Transaction</button>
    </div>
    <div class="buttons">
        <button onclick="saveToFile()">Save to File</button>
        <button onclick="exportToExcel()">Export to Excel</button>
        <input type="file" id="fileInput" style="display: none;" onchange="loadFromFile(event)">
        <button onclick="document.getElementById('fileInput').click()">Load from File</button>
    </div>
  </div>

  <!-- Right Panel -->
  <div class="right-panel">
    <div class="chart-container">
      <h3>Expense Breakdown</h3>
      <canvas id="categoryPieChart"></canvas>
    </div>
    <div class="transaction-list">
      <ul id="transactionList"></ul>
    </div>
    <div style="text-align: right; margin-top: 20px;">
      <button onclick="clearTransactions()" style="padding: 10px 20px; background: #e74c3c; color: white; border: none; border-radius: 6px; cursor: pointer;">Clear Transactions</button>
    </div>
      <script>
        function renderTransactions() {
          const transactionList = document.getElementById("transactionList");
          transactionList.innerHTML = "";
          transactions.forEach((transaction, index) => {
            const li = document.createElement("li");
            li.className = "transaction-item";
            li.innerHTML = `
              <div>${transaction.date} - ${transaction.description} ($${transaction.amount}) - ${transaction.category}</div>
              <button onclick="deleteTransaction(${index})">Delete</button>
            `;
            transactionList.appendChild(li);
          });
        }
      </script>
  </div>
</div>

<footer>Created By Ryan McDowell</footer>

<script>
  let transactions = [];
  let categoryExpenses = {
    income: 0,
    groceries: 0,
    rent: 0,
    entertainment: 0,
    others: 0,
  };
  let pieChart;

  function addTransaction() {
    const description = document.getElementById("description").value;
    const amount = parseFloat(document.getElementById("amount").value);
    const category = document.getElementById("category").value;
    const date = document.getElementById("date").value;
  
    if (!description || isNaN(amount) || !date) {
      alert("Please fill out all fields!");
      return;
    }
  
    transactions.push({ description, amount, category, date });
  
    // Update category totals
    if (category === "income") {
      categoryExpenses.income += amount; // Add to income
    } else {
      categoryExpenses[category] += amount; // Add to expense
    }
  
    renderTransactions();
    updatePieChart();
    clearForm();
  }

  function renderTransactions() {
    const transactionList = document.getElementById("transactionList");
    transactionList.innerHTML = "";
    transactions.forEach((transaction, index) => {
      const li = document.createElement("li");
      li.className = "transaction-item";
      li.innerHTML = `
        <div>${transaction.date} - ${transaction.description} ($${transaction.amount}) - ${transaction.category}</div>
        <button onclick="deleteTransaction(${index})">Delete</button>
      `;
      transactionList.appendChild(li);
    });
  }

  // Save transactions to a JSON file
function saveToFile() {
    const blob = new Blob([JSON.stringify(transactions)], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "transactions.json";
    a.click();
  }
  
  // Export transactions to an Excel file
  function exportToExcel() {
    const worksheet = XLSX.utils.json_to_sheet(transactions);
    const workbook = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(workbook, worksheet, "Transactions");
    XLSX.writeFile(workbook, "transactions.xlsx");
  }
  
  // Load transactions from an Excel file
  function loadFromFile(event) {
    const file = event.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function (e) {
        const data = e.target.result;
  
        // Read the workbook from the binary data
        const workbook = XLSX.read(data, { type: "binary" });
        const sheetName = workbook.SheetNames[0];
        const sheet = workbook.Sheets[sheetName];
  
        // Convert sheet to JSON
        const json = XLSX.utils.sheet_to_json(sheet);
  
        // Reset categoryExpenses to start fresh
        categoryExpenses = {
          income: 0,
          groceries: 0,
          rent: 0,
          entertainment: 0,
          others: 0,
        };
  
        // Process the transactions and rebuild data
        transactions = []; // Clear the transactions array
        json.forEach((transaction, index) => {
          const amount = parseFloat(transaction.amount);
          const category = transaction.category;
          const description = transaction.description || "";
          const date = transaction.date || "";
  
          // Validate data
          if (!category || typeof category !== "string") {
            console.error(`Invalid category at row ${index + 1}:`, transaction);
            return; // Skip invalid transaction
          }
          if (isNaN(amount)) {
            console.error(`Invalid amount at row ${index + 1}:`, transaction);
            return; // Skip invalid transaction
          }
  
          // Ensure the category exists in categoryExpenses
          if (!categoryExpenses.hasOwnProperty(category)) {
            categoryExpenses[category] = 0; // Dynamically add new categories if needed
          }
  
          // Add the transaction to the list
          transactions.push({ description, amount, category, date });
  
          // Update the category total
          categoryExpenses[category] += amount;
        });
  
        // Update the UI
        renderTransactions();
        updatePieChart();
  
        // Reset the file input to allow reloading the same file
        event.target.value = "";
      };
      reader.readAsBinaryString(file);
    }
  }

  function clearTransactions() {
    // Reset the transactions array
    transactions = [];
  
    // Reset the category expenses
    categoryExpenses = {
      income: 0,
      groceries: 0,
      rent: 0,
      entertainment: 0,
      others: 0,
    };
  
    // Clear the transaction list
    renderTransactions();
  
    // Reset the pie chart
    if (pieChart) {
      pieChart.destroy();
      pieChart = null;
    }
  }

  function deleteTransaction(index) {
    const transaction = transactions[index];
    const amount = parseFloat(transaction.amount);
    const category = transaction.category;
  
    // Subtract the amount from the corresponding category
    categoryExpenses[category] -= amount;
  
    // Remove the transaction
    transactions.splice(index, 1);
  
    // Re-render transactions and update the pie chart
    renderTransactions();
    updatePieChart();
  }

  function clearForm() {
    document.getElementById("description").value = "";
    document.getElementById("amount").value = "";
    document.getElementById("category").value = "income";
    document.getElementById("date").value = "";
  }

  function updatePieChart() {
    const ctx = document.getElementById("categoryPieChart").getContext("2d");
  
    // Calculate the total income and total expenses
    const totalIncome = categoryExpenses.income;
    const totalExpenses = Object.keys(categoryExpenses)
      .filter((key) => key !== "income")
      .reduce((sum, key) => sum + Math.abs(categoryExpenses[key]), 0);
  
    // If there's no income, reset the pie chart
    if (totalIncome === 0) {
      if (pieChart) {
        pieChart.destroy();
        pieChart = null;
      }
      return; // Exit the function as there's nothing to display
    }
  
    // Prepare data and labels for the chart
    const data = [];
    const labels = [];
  
    // Calculate remaining income and percentages
    const remainingIncome = totalIncome - totalExpenses;
    const remainingIncomePercentage = (remainingIncome / totalIncome) * 100;
  
    // Add income as the base
    data.push(remainingIncome);
    labels.push(`Income (Base): ${remainingIncomePercentage.toFixed(2)}% ($${remainingIncome.toFixed(2)})`);
  
    // Add expenses as portions of the total income
    Object.keys(categoryExpenses).forEach((key) => {
      if (key !== "income" && categoryExpenses[key] !== 0) {
        const percentage = (Math.abs(categoryExpenses[key]) / totalIncome) * 100;
        data.push(Math.abs(categoryExpenses[key])); // Use absolute value for chart data
        labels.push(`${key}: ${percentage.toFixed(2)}% (-$${Math.abs(categoryExpenses[key]).toFixed(2)})`);
      }
    });
  
    // Destroy the existing chart if it exists
    if (pieChart) {
      pieChart.destroy();
    }
  
    // Create a new pie chart
    pieChart = new Chart(ctx, {
      type: "pie",
      data: {
        labels: labels,
        datasets: [
          {
            data: data,
            backgroundColor: [
              "#36A2EB", // Income
              "#FF6384", // Groceries
              "#FFCE56", // Rent
              "#4BC0C0", // Entertainment
              "#9966FF", // Others
            ],
          },
        ],
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            position: "bottom",
          },
          tooltip: {
            callbacks: {
              label: function (tooltipItem) {
                return `${labels[tooltipItem.dataIndex]}`;
              },
            },
          },
        },
      },
    });
  }

</script>
</body>
</html>
